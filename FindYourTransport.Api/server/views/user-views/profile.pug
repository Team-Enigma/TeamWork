extends ../base

block app-title
        | Profile

block content
    div.ride-detailed-container
        .row
            .col-lg-12
                .row.main-row
                    .col-lg-2.matchheight
                        img.avatar-image(src=`/images/users-avatars/${currentUser.avatar}` alt="No image!")
                    .col-lg-10.matchheight.bot-vert-align
                        div
                            .row
                                h1.profile-username #{currentUser.username}
                            .row
                                h2.profile-names #{currentUser.firstName} #{currentUser.lastName}
                hr
        .row
            .col-lg-3
                ul.nav.nav-pills.nav-stacked
                    li.active
                        a(href="#profile" data-toggle="pill", aria-expanded="true") Profile
                    li
                        a(href="#rides" data-toggle="pill", aria-expanded="true") Rides
                    li
                        a(href="#update-profile" data-toggle="pill", aria-expanded="false") Update profile
                    li
                        a(href="#update-profile-picture" data-toggle="pill", aria-expanded="false") Update profile picture
                    li
                        a(href="#update-car" data-toggle="pill", aria-expanded="false") Update car
            .col-lg-9
                #my-tab-content.tab-content
                    #profile.tab-pane.fade.active.in
                        .matchheight
                                    p Profile information
                    #rides.tab-pane.fade
                        .matchheight
                            p Rides
                            if rides.length > 0    
                            each ride in rides
                                .row.ride-container
                                        .col-lg-12
                                                .row.main-row
                                                .col-lg-4.ride-lg
                                                        span #{ride.fromCity}
                                                .col-lg-1.ride-lg
                                                        span.glyphicon.glyphicon-chevron-right
                                                .col-lg-4.ride-lg
                                                        span #{ride.toCity}
                                                .col-lg-3.ride-lg
                                                        span #{moment(ride.dateOfTravel).format("lll")}
                                                hr
                                                .row.secondary-row
                                                .col-lg-5.ride-md
                                                        span Available seats:
                                                        span  #{ride.freePlaces}
                                                .col-lg-4.ride-md
                                                        span Price:
                                                        span  #{ride.price}
                                                .col-lg-3.ride-md
                                                        form(action=`/rides/${ride.id}` method="post")
                                                                a(href=`/rides/${ride.id}`) Details 
                                                                input.hidden(type="text" name="rideId" value=`${ride.id}`)
                                                                input.btn.btn-danger.btn-sm(type="submit" value="Remove ride")
                            else 
                                span.text-info This user has no rides
                    #update-profile.tab-pane.fade
                        .matchheight
                            p Profile
                            .matchheight
                                form(id="update-profile" action="/profile/update-info", method="post")
                                    .group
                                        label.control-label(for="tb-first-name") First name:
                                        input(id="tb-first-name", type="text", name="firstName", value=`${currentUser.firstName}`)
                                    .group
                                        label.control-label(for="tb-last-name") Last name:
                                        input(id="tb-last-name", type="text", name="lastName", value=`${currentUser.lastName}`)
                                    .group    
                                        label.control-label(for="tb-email") E-mail
                                        input(id="tb-email", type="email", name="email", value=`${currentUser.email}`) 
                                    .group
                                        input.btn.btn-success.btn-special(type="submit", value="Update")
                    #update-profile-picture.tab-pane.fade
                        .matchheight
                            .row
                                form(id="upload", action="/profile/upload-avatar", method="post", enctype="multipart/form-data")
                                    .form-group
                                        p.font-md Please select image
                                        label.btn.btn-primary.btn-file(for="tb-avatar")
                                            | Browse
                                        input(type="file", id="tb-avatar" name="avatar" accept="image/*")
                    #update-car.tab-pane.fade
                        .matchheight
                            p Car

    script(type="text/javascript").
        jQuery(function($){
        $("#tb-avatar").change(function() {
                $("#upload").submit();
            });
        });

    script(type="text/javascript").
        jQuery(function($){
        $(".matchheight").matchHeight({byRow: false});
        });